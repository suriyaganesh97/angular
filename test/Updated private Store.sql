


--tab 1   WeeklyReg_WeeklyPurchase

select MBRGRPNAME,UsersCount,OrderCount,round((OrderCount/UsersCount)*100,2) as PERCENTAGE from (
select A.MBRGRPNAME,UsersCount,nvl(orderCount,0)as OrderCount from (
select MBRGRPNAME,COUNT(*) as UsersCount FROM USERS U JOIN MBRGRPMBR MG ON U.USERS_ID=MG.MEMBER_ID
JOIN MBRGRP P ON P.MBRGRP_ID=MG.MBRGRP_ID
WHERE REGISTRATION>SYSDATE-7 and P.MBRGRP_ID in ('8000000000000000502','8000000000000000504','8000000000000001001','8407790678950002502','8407790678950003002','8407790678950003003','8407790678950005002','8407790678950005502','8407790678950006002','8407790678950006003','8407790678950007502','8407790678950008003','8407790678950008004','8407790678950008005','8407790678950008006','8407790678950009003','8407790678950009502','8407790678950009503','8407790678950010002','8407790678950010502','8407790678950011002','8407790678950011003','8407790678950011502','8407790678950012002','8407790678950012502','8407790678950013002','8407790678950013503','8407790678950014002')
GROUP BY MBRGRPNAME) A,
(SELECT MBRGRPNAME,COUNT(*) as orderCount FROM ORDERS O JOIN MBRGRPMBR MG ON O.MEMBER_ID=MG.MEMBER_ID
JOIN MBRGRP X ON MG.MBRGRP_ID=X.MBRGRP_ID
JOIN USERS U on U.USERS_ID=MG.MEMBER_ID WHERE REGISTRATION>SYSDATE-7 and status='F' and X.MBRGRP_ID in ('8000000000000000502','8000000000000000504','8000000000000001001','8407790678950002502','8407790678950003002','8407790678950003003','8407790678950005002','8407790678950005502','8407790678950006002','8407790678950006003','8407790678950007502','8407790678950008003','8407790678950008004','8407790678950008005','8407790678950008006','8407790678950009003','8407790678950009502','8407790678950009503','8407790678950010002','8407790678950010502','8407790678950011002','8407790678950011003','8407790678950011502','8407790678950012002','8407790678950012502','8407790678950013002','8407790678950013503','8407790678950014002') and timeplaced is not null
GROUP BY MBRGRPNAME)B
where A.MBRGRPNAME = B.MBRGRPNAME(+));

--tab 2   TotalReg_WeeklyPurchase

select MBRGRPNAME,UsersCount,OrderCount,round((OrderCount/UsersCount)*100,2) as PERCENTAGE from (
select A.MBRGRPNAME,UsersCount, OrderCount from (
select MBRGRPNAME AS MBRGRPNAME,COUNT(*) as UsersCount FROM USERS  U JOIN MBRGRPMBR MG ON U.USERS_ID=MG.MEMBER_ID
JOIN MBRGRP P ON P.MBRGRP_ID=MG.MBRGRP_ID WHERE P.MBRGRP_ID in ('8000000000000000502','8000000000000000504','8000000000000001001','8407790678950002502','8407790678950003002','8407790678950003003','8407790678950005002','8407790678950005502','8407790678950006002','8407790678950006003','8407790678950007502','8407790678950008003','8407790678950008004','8407790678950008005','8407790678950008006','8407790678950009003','8407790678950009502','8407790678950009503','8407790678950010002','8407790678950010502','8407790678950011002','8407790678950011003','8407790678950011502','8407790678950012002','8407790678950012502','8407790678950013002','8407790678950013503','8407790678950014002')
GROUP BY MBRGRPNAME) A,
(SELECT MBRGRPNAME AS MBRGRPNAME,COUNT(*) as OrderCount FROM ORDERS O JOIN MBRGRPMBR MG ON O.MEMBER_ID=MG.MEMBER_ID
JOIN MBRGRP X ON MG.MBRGRP_ID=X.MBRGRP_ID WHERE TIMEPLACED>SYSDATE-7 AND X.MBRGRP_ID in ('8000000000000000502','8000000000000000504','8000000000000001001','8407790678950002502','8407790678950003002','8407790678950003003','8407790678950005002','8407790678950005502','8407790678950006002','8407790678950006003','8407790678950007502','8407790678950008003','8407790678950008004','8407790678950008005','8407790678950008006','8407790678950009003','8407790678950009502','8407790678950009503','8407790678950010002','8407790678950010502','8407790678950011002','8407790678950011003','8407790678950011502','8407790678950012002','8407790678950012502','8407790678950013002','8407790678950013503','8407790678950014002') AND TIMEPLACED IS NOT NULL AND STATUS='F'
GROUP BY MBRGRPNAME) B 
where A.MBRGRPNAME = B.MBRGRPNAME(+));

--tab 3  12Mon_PurchaseDetails

select sum(TOTALPRODUCT+ TOTALTAX +TOTALSHIPPING +TOTALTAXSHIPPING+ TOTALADJUSTMENT) as totalpurchaseamount,ur.logonid,to_char(REGISTRATION, 'MM/DD/YYYY') as REGISTRATION,to_char(max(timeplaced), 'MM/DD/YYYY') as LASTORDERDATE,TIER_CODE from orders o
join userreg ur on o.member_id=ur.users_id
join users u on ur.users_id=u.users_id
join mbrgrpmbr mg on ur.users_id=mg.member_id join x_pstore xp on  mg.mbrgrp_id=xp.mbrgrp_id
where o.member_id in (select member_id from mbrgrpmbr where mbrgrp_id in (select mbrgrp_id from mbrgrp
where mbrgrp_id in 
('8407790678950002502','8407790678950003002','8407790678950006003','8407790678950008004','8407790678950012002','8407790678950007502','8407790678950009003','8407790678950013002','8407790678950003003','8407790678950009502','8407790678950009503','8407790678950014002','8407790678950013503','8407790678950005502','8407790678950006002','8407790678950008006','8407790678950008003','8407790678950008005','8407790678950011502','8407790678950014502','8407790678950005002','8407790678950010002','8407790678950010502','8407790678950011002','8407790678950011003')))
and o.status='F' and timeplaced is not null and timeplaced>sysdate-365 group by ur.logonid,REGISTRATION,TIER_CODE order by TIER_CODE ;


  
--tab 4     TotalPurchaseDetails 

select LOGONID,to_char(LASTORDER, 'MM/DD/YYYY') as LASTORDER,to_char(REGISTRATION, 'MM/DD/YYYY') AS REGISTRATION,ORDER_NO,PRODUCTPARTNUMBER,QUANTITY,PRODUCTCATEGORY,PRODUCTSUBCATEGORY,PRODUCTNAME,to_char(TIMEPLACED, 'MM/DD/YYYY') AS TIMEPLACED,ORDERTOTAL,SALESCHANNEL,PRIVATESTORE,PRODUCTLINE from
(select logonid as LOGONID,lastorder as LASTORDER,REGISTRATION ,ormorder as ORDER_NO,partnum as PRODUCTPARTNUMBER,oi.quantity as QUANTITY,identifier,value,
cd.name as PRODUCTNAME,timeplaced as TIMEPLACED,
(o.totalproduct+o.totaltax+o.totalshipping+o.totaltaxshipping) as ORDERTOTAL,b.name as SALESCHANNEL,TIER_CODE as PRIVATESTORE
from orders o join userreg u on
o.member_id=u.users_id join mbrgrpmbr mg on o.member_id=mg.member_id join x_pstore xp on xp.mbrgrp_id=mg.mbrgrp_id
join orderitems oi on o.orders_id=oi.orders_id
join catentdesc cd on oi.catentry_id=cd.catentry_id right join users ur on o.member_id=ur.users_id
join buschn b on o.buschn_id=b.buschn_id
join catentryattr ca on ca.catentry_id=oi.catentry_id
join attr ar on ca.attr_id=ar.attr_id
join attrvaldesc adc on adc.attrval_id=ca.attrval_id
where o.member_id in (select member_id from mbrgrpmbr where mbrgrp_id in 
('8407790678950007502','8407790678950009003','8407790678950013002','8407790678950002502','8407790678950003002','8407790678950003003','8407790678950009502','8407790678950009503','8407790678950014002','8407790678950013503','8407790678950005502','8407790678950006002','8407790678950006003','8407790678950008006','8407790678950008003','8407790678950008005','8407790678950008004','8407790678950011502','8407790678950014502','8407790678950005002','8407790678950010002','8407790678950010502','8407790678950011002','8407790678950011003','8407790678950012002'))
 and timeplaced>sysdate-365 and o.status='F')
pivot
(
max(value) for identifier in
('pm_category' as PRODUCTCATEGORY,'product_line' as PRODUCTLINE,'pm_subcategory' as PRODUCTSUBCATEGORY)) order by timeplaced desc;


--tab 5    gallagher registration details 

select logonid as Email_address,to_char(registration,'mm/dd/yy') as registration_date,mbrgrpname as Store_name,name as Company_name,cic as company_code from userreg U
join mbrgrpmbr mgr on U.users_id =mgr.member_id
join users US on US.users_id=mgr.member_id
join XHP_EPP_COMPANY XHP on XHP.cic=US.field3
join mbrgrp mg on mg.mbrgrp_id = mgr.mbrgrp_id
where registration>sysdate-7 and mg.mbrgrp_id in ('8407790678950013002') order by registration;

--tab 6 bizclubsilverB details
select logonid as Email_address,to_char(registration,'mm/dd/yy') as registration_date,mbrgrpname as Store_name from userreg U
join mbrgrpmbr mgr on U.users_id =mgr.member_id
join users US on US.users_id=mgr.member_id
join mbrgrp mg on mg.mbrgrp_id = mgr.mbrgrp_id
where registration>sysdate-7 and mg.mbrgrp_id in ('8407790678950005502') order by registration;