queries

--ESPOT validation    run in stage
sort by enddate to check the recent espots ending
select * from dmactivity where enddate>sysdate +1; 


--CTO validation run in stage the below query shows only which are buyable=1 and published=1 in stage
select ca.catentry_id,ca.partnumber,cf.reference,cd.published,cdr.published from catentry ca, catentdesc cd, catentdescovr cdr ,catconfinf cf where ca.catentry_id=cd.catentry_id and cd.catentry_id=cdr.catentry_id and
cdr.catentry_id=cf.catentry_id and SUBSTR (cf.REFERENCE, 1, INSTR (cf.REFERENCE, '/', -1) - 1) in ('US_005FStore/Store/NEW_0020_002D_0020SMB_0020Desktops/Z6_005FG4','US_005FStore/Store/NEW_0020_002D_0020SMB_0020Desktops/ProDesk_005F600_005FG5_005FSFF','US_005FStore/Store/NEW_0020_002D_0020SMB_0020Desktops/EliteOne_005F800_005FG5','US_005FStore/Store/NEW_0020_002D_0020SMB_0020Desktops/Z4_005FG4','US_005FStore/Store/NEW_0020_002D_0020SMB_0020Desktops/Z8_005FG4','US_005FStore/Store/Desktops/6XQ75AV','US_005FStore/Store/Desktops/8QQ59AV','US_005FStore/Store/Desktops/6XQ76AV','US_005FStore/Store/Desktops/4AB24AV','US_005FStore/Store/Desktops/7BB48AV','US_005FStore/Store/Desktops/7BB49AV','US_005FStore/Store/Desktops/6XQ71AV','US_005FStore/Store/Desktops/4WP44AV','US_005FStore/Store/Desktops/4WP40AV','US_005FStore/Store/Desktops/7HZ80AV','US_005FStore/Store/Desktops/6XQ72AV','US_005FStore/Store/Desktops/2TB61AV','US_005FStore/Store/Desktops/6FH15AV','US_005FStore/Store/Desktops/2SS03AV','US_005FStore/Store/Desktops/7BB47AV','US_005FStore/Store/Laptops/8VB17AV','US_005FStore/Store/Laptops/8DV34AV','US_005FStore/Store/Laptops/8DV35AV','US_005FStore/Store/Laptops/7FQ24AV','US_005FStore/Store/Laptops/3JE20AV','US_005FStore/Store/Laptops/6VC02AV')
and ca.markfordelete=0 and cd.published=1 and cdr.published=1; 
 
run the query without cd.published and cdr.published to get all models later check those models in the MC

click create run time version of the model if underscore is present never compile a model

expired model check whether it is present in the model sync job,if present take partnumber and send mail to ops team and ask them to remove from todays list

--PST validation run in stage
if the total difference is more than 200(400 or 500) ask to run the job again

to check base price and px price is zero for any product
select distinct catentry_id from xcatentdisprice where px_price = 0 or baseprice= 0; 

to check for what customer segments and type prices have been changed sort by cusseg_id and check
select cusseg_id,eff_date,update_type,count(*) from xcatentdisprice where eff_date in('23-1-2020_08-00-01','24-1-2020_08-00-01')  group by cusseg_id,update_type,eff_date order by eff_date;
 
 to get skus for categories where price has changed for types like segments,bundles and dynamic kits for today and tomorrow 
 (select distinct catentry_id from xcatentdisprice where update_type='SEGMENTS' and eff_date in ('23-1-2020_08-00-01'))
minus (select distinct catentry_id from xcatentdisprice where update_type='SEGMENTS' and eff_date in ('24-1-2020_08-00-01'));

to check buyable for the products
select catentry_id,partnumber,buyable from catentry where catentry_id in ('21199','137839','1597175','1597184','3074457345618589818','3074457345619488333');


to check publishable for the products
select catentry_id,available,published from catentdesc where catentry_id in ('21199','137839','1597175','1597184','3074457345618589818','3074457345619488333'); 


if buyable is 1 then check the partnumber if partnumber is like P_CC522A#BGJ  this means that it is a parent SKU so no issues only if the other partnumbers are 1 then it is an issues


--MARKET PRICE VALIDATION run in stage
if price difference is negative or null check it,
check for yesterday's and today's catalog feed id  
select PARTNUMBER, TODAYSPRICE, YESTERDAYSPRICE, (TODAYSPRICE-YESTERDAYSPRICE) as pricediff
from (
select * from (
select ccfpd.feed_id, ca.PARTNUMBER, ccfpd.PRICE
--, ccfpd.ADJUSTMENT_VALUE, ccfpd.LPRICE, ccfpd.DAYS_OFFSET
from CA_CATALOG_FEED_PROD_DATA ccfpd, catentry ca
where ccfpd.catentry_id = ca.catentry_id
and ccfpd.DAYS_OFFSET=0
and ccfpd.feed_id in (1998,1995)
)
pivot (max (price) for feed_id in (1998 as todaysprice, 1995 as yesterdaysprice))
);

gives data like feedid, catentry id and promotion message
select * from ca_catalog_feed_prod_data where catentry_id in(select catentry_id from catentry where partnumber in('CN045AN#140')) order by feed_id desc; 

if price for today is null, checking whether it is buyable=0 in store today , price for yesterday is null,then buyable should be 1 today 
select buyable from catentry where partnumber= '3ZF16UT#ABA';  
 

--Rtam validation run in stage pulls data from wcs and oms live
run in oms change the date and run
select p.item_id as partnumber,p.quantity as supply_temp ,s.quantity as supply from YFS_INVENTORY_SUPPLY_temp p,YFS_INVENTORY_SUPPLY s 
where p.INVENTORY_SUPPLY_TEMP_KEY like '20200131%'  and p.INVENTORY_ITEM_KEY=s.INVENTORY_ITEM_KEY;



select p.item_id as partnumber,p.quantity as supply_temp ,s.quantity as supply from YFS_INVENTORY_SUPPLY_temp@TP_MKT_EDIT_OMS p,YFS_INVENTORY_SUPPLY@TP_MKT_EDIT_OMS s 
where p.INVENTORY_SUPPLY_TEMP_KEY like '20200121%'  and p.INVENTORY_ITEM_KEY=s.INVENTORY_ITEM_KEY;

mail from praneeth
Use this only if your eclipse script is not working (Run in wcs stage) :

Pre and post query:

select p.item_id as partnumber,p.quantity as supply_temp ,s.quantity as supply from YFS_INVENTORY_SUPPLY_temp@TP_MKT_EDIT_OMS p,YFS_INVENTORY_SUPPLY@TP_MKT_EDIT_OMS s where p.INVENTORY_SUPPLY_TEMP_KEY like '20191106%'  and p.INVENTORY_ITEM_KEY=s.INVENTORY_ITEM_KEY

Final validation query: run in stage
select Live.*,(oms.quantity) OMS_Availability from (select distinct(RTRIM(t.item_id)) as partnumber,s.quantity from YFS_INVENTORY_SUPPLY_temp@TP_MKT_EDIT_OMS t,YFS_INVENTORY_SUPPLy@TP_MKT_EDIT_OMS s where t.INVENTORY_ITEM_KEY=s.INVENTORY_ITEM_KEY) oms , 
(select c.partnumber,i.AVAILQUANTITY from catentry@TP_MKT_EDIT_LIVE c,invavl@TP_MKT_EDIT_LIVE i where c.catentry_id=i.catentry_id ) Live where Live.partnumber=oms.partnumber

LV290AA#ABA
N4G63AA#ABA

https://store.hp.com/us/en/pdp/hp-envy-laptop-17t-6vc02av-1
https://store.hp.com/us/en/ConfigureView?catalogId=10051&langId=-1&storeId=10151&urlLangId=&catEntryId=3074457345619343818&quantity=1




